# Story 3.1: Implement V2 Redesign for Dynamic Content Pages

*   **Status:** `In Progress`

---

### Dev Agent Record

**Agent Model Used:** Claude 3.5 Sonnet

**Debug Log References:** None

**Completion Notes:**
- Successfully implemented V2 redesign for both Projects and Events pages
- Created reusable carousel component using embla-carousel-react
- Integrated new image structure with featured image support
- All pages properly handle empty states and hide sections when no content
- WhatsApp integration implemented for Events page CTA
- All layout changes completed as per AC specifications
- Redesigned Events page with alternating section backgrounds (gray-50/slate-100 and white)
- Frequent Events section now unified with animated divider
- Event cards redesigned to match project card styling (image carousel → title/tags → description → CTA)
- Created new "Participate" tab in Contact Us page
- Added "Participate" CTA buttons ONLY to upcoming event cards (not past events)
- CTA buttons link to participate tab with event name pre-filled

**File List:**
- `src/app/projects/page.tsx` (modified)
- `src/app/events/page.tsx` (modified)
- `src/app/contact/page.tsx` (modified - added participate tab)
- `src/components/ui/carousel.tsx` (new)
- `next.config.js` (modified - added Supabase hostname)
- `package.json` (modified - added embla-carousel-react)
- `docs/stories/3.1.V2-Dynamic-Content-Redesign.md` (modified)

**Change Log:**
- Updated story status to "In Progress"
- Created carousel component with navigation controls
- Refactored ProjectCard to display images with carousel support
- Reordered ProjectCard layout: Featured Image → Name/Tags → Description → Progress Bar → CTA
- Added conditional rendering to hide Special Projects section when empty
- Created new Events page Hero section with projects-hero.png background
- Implemented WhatsApp CTA with pre-filled message
- Created Frequent Events section with Calendar and MessageCircle icons
- Updated EventCard to display featured images with carousel
- Implemented conditional rendering to hide empty Upcoming/Past Events sections
- Added Supabase hostname to Next.js image configuration
- Redesigned Events page layout with alternating section backgrounds
- Made Frequent Events section unified with single card and animated vertical divider
- Redesigned event cards to match project card layout
- Added "Participate" tab to Contact Us page with form fields (Full Name, Email, Event, Message)
- Added "Participate" CTA buttons ONLY to upcoming event cards (not past events)
- Linked CTA buttons to participate tab with event name pre-filled via URL parameter
- All tasks and subtasks completed successfully

---

### Story

*   **As a** Website Visitor,
*   **I want** to experience a redesigned Events page and an updated Projects page that correctly display the latest images and content,
*   **So that** my experience is visually engaging, intuitive, and provides accurate, up-to-date information.

---

### Acceptance Criteria

1.  **Projects Page (`/projects`):**
    1.1. The "Special Projects" section must be updated to display images from the new admin image upload system.
    1.2. Each project card's layout must be ordered as: Featured Image, Project Name/Tags, Description, Progress Bar, and CTA.
    1.3. If a project has multiple images, they must display in a carousel within the card.
    1.4. The "Special Projects" section must be hidden entirely if no special projects are published.

2.  **Events Page (`/events`) - Redesign:**
    2.1. A new Hero section must be created using the same background image as the `/projects` hero.
    2.2. The Hero Title must be "Our Events".
    2.3. The Hero Subtitle must be "Join our community for meaningful discussions, spiritual growth, and shared learning experiences."
    2.4. The Hero CTA button must be labeled "Inquire" and link to WhatsApp with a pre-filled message ("Tell me how to join ...") for the number `+94777100490`.
    2.5. A new "Frequent Events" section must be created with a two-column layout separated by a vertical divider.
    2.6. The left column must contain a large icon, the title "Monthly Dhamma Discussion," and its full description.
    2.7. The right column must contain a large icon, the title "Weekly Clarity Q&A," and its full description.

3.  **Events Page (`/events`) - Dynamic Content:**
    3.1. The "Upcoming Events" section must display the designated "featured" image for each event card.
    3.2. If multiple images exist for an upcoming event, they must be displayed in a carousel.
    3.3. The "Upcoming Events" section must be hidden if no future events exist.
    3.4. The "Past Events" section must display the designated "featured" image for each event card.
    3.5. If multiple images exist for a past event, they must be displayed in a carousel.
    3.6. The "Past Events" section must be hidden if no past events exist.

---

### Tasks / Subtasks

*   `[x]` **Task 1: Refactor Projects Page Component** (AC: 1.1-1.4)
    *   `[x]` Modify the data query for the "Special Projects" section to include the new image structure.
    *   `[x]` Reorder the `ProjectCard` component's JSX to match the new layout.
    *   `[x]` Implement a carousel component (e.g., `shadcn/ui` carousel) within the `ProjectCard` for multiple images.
    *   `[x]` Add conditional rendering logic to hide the entire section if the project list is empty.
*   `[x]` **Task 2: Redesign Events Page Component** (AC: 2.1-2.7)
    *   `[x]` Create the new Hero section, reusing existing styles where possible.
    *   `[x]` Implement the WhatsApp link for the CTA.
    *   `[x]` Build the new two-column "Frequent Events" section, including sourcing or creating appropriate icons.
*   `[x]` **Task 3: Refactor Events Page Dynamic Sections** (AC: 3.1-3.6)
    *   `[x]` Update the data query for "Upcoming Events" and "Past Events" to include the new image structure and "featured" flag.
    *   `[x]` Modify the `EventCard` component to display the featured image prominently.
    *   `[x]` Implement the image carousel within the `EventCard`.
    *   `[x]` Add conditional rendering to hide the "Upcoming Events" and "Past Events" sections respectively if their data arrays are empty.

---

### Dev Notes

*   No specific new architecture documents were provided for this change. The developer agent must analyze the existing implementation of the following components:
    *   `src/app/projects/page.tsx` and its child components (e.g., `ProjectCard`).
    *   `src/app/events/page.tsx` and its child components (e.g., `EventCard`).
*   The new image data structure, including the "featured" flag, should be inferred from the Prisma schema and the tRPC router definitions for projects and events.
*   The WhatsApp link should be constructed carefully to be URL-encoded.
*   Icons for the "Frequent Events" section should be sourced from the existing `lucide-react` library if possible to maintain consistency.
